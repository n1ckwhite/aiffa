#  git push и конфликты с удалённым репозиторием

##  Как работает `git push`, если есть конфликты с удалённым репозиторием?

Команда `git push` отправляет ваши локальные коммиты в удалённый репозиторий. Но если в удалённой ветке появились новые коммиты, которых нет у вас локально, push не выполнится — возникнет конфликт. Это защищает проект от потери данных и случайного перезаписывания чужой работы.

---

##  TLDR

| Проблема | Почему | Что делать |
| --- | --- | --- |
| rejected (fetch first) | На сервере появились новые коммиты | `git pull`, решить конфликты, снова `git push` |
| Нужен force | История расходится намеренно | Только `--force-with-lease` и по согласованию |

---

###  Как возникает конфликт при push?

- Если кто-то другой внёс изменения в удалённую ветку после вашего последнего pull/fetch, ваша история расходится с историей на сервере.
- Git не позволит выполнить push, пока вы не синхронизируете свою ветку с удалённой.
- Вы увидите ошибку вроде:
```
! [rejected]        main -> main (fetch first)
error: failed to push some refs to 'origin'
```

---

###  Как решить конфликт при push?

1. **Получите последние изменения из удалённого репозитория:**
```bash
git pull origin <имя-ветки>
```
2. **Разрешите конфликты, если они возникли:**
   - Откройте файлы с конфликтами (Git пометит их маркерами `<<<<<<<`, `=======`, `>>>>>>>`).
   - Вручную исправьте конфликтующие участки.
   - Сохраните изменения.
3. **Добавьте исправленные файлы в индекс:**
```bash
git add <имя-файла>
```
4. **Завершите слияние:**
```bash
git commit
```
   (Если pull не создал коммит автоматически)
   
5. **Снова выполните push:**
```bash
git push origin <имя-ветки>
```

> Совет: включите «защищённые ветки» в репозитории — это предотвратит случайный push в `main`/`develop` и потребует PR.

---

###  Пример типичного сценария

```bash
git push origin main
# Ошибка: нужно сначала получить изменения

git pull origin main
# Возникает конфликт в файле app.js
# Открываем app.js, исправляем конфликт

git add app.js
git commit -m "Решён конфликт при слиянии main"
git push origin main
```

---

##  Рекомендации

- Перед push всегда делайте `git fetch` или `git pull`, чтобы убедиться, что ваша ветка актуальна.
- Разрешайте конфликты внимательно, чтобы не потерять важные изменения.
- Если конфликтов много, обсуждайте с командой стратегию слияния.
- Используйте осмысленные сообщения коммитов при разрешении конфликтов.

> Важно: избегайте `--force` для общих веток. Если без него не обойтись — `--force-with-lease` и предварительное уведомление команды.

---

##  Полезные ссылки

- [Git — push](https://git-scm.com/docs/git-push)
- [О защите веток в GitHub](https://docs.github.com/ru/repositories/configuring-branches-and-merges-in-your-repository/defining-the-mergeability-of-pull-requests/about-protected-branches)

---

##  Итог

- Если при push возникает конфликт, сначала синхронизируйте ветку с помощью pull.
- Разрешите все конфликты, завершите слияние и только после этого повторяйте push.
- Такой подход защищает проект от потери данных и случайных ошибок.

---