#  Этап 38 — Что такое async и defer?

**Атрибуты `async` и `defer`** — это способы управления загрузкой и выполнением JavaScript-файлов в HTML. Они позволяют **оптимизировать производительность** веб-страниц, контролируя, когда и как браузер обрабатывает скрипты.

Без этих атрибутов браузер **блокирует рендеринг** страницы до полной загрузки и выполнения всех скриптов, что может значительно замедлить отображение контента.

---

##  Проблема без async/defer

**Обычная загрузка скрипта:**

```html
<script src="app.js"></script>
```

**Что происходит:**
1. Браузер находит тег `<script>`
2. **Останавливает парсинг HTML**
3. Загружает файл `app.js`
4. Выполняет код из `app.js`
5. **Возвращается к парсингу HTML**

 Это создает **блокировку рендеринга** и замедляет загрузку страницы.

---

##  Атрибут `async`

**Асинхронная загрузка** — скрипт загружается параллельно с парсингом HTML, но выполняется сразу после загрузки.

```html
<script async src="app.js"></script>
```

**Что происходит:**
1. Браузер находит тег `<script async>`
2. **Продолжает парсить HTML** (не блокирует)
3. Загружает `app.js` **параллельно**
4. Как только файл загружен — **сразу выполняет** его
5. Может прервать парсинг HTML для выполнения

---

###  Особенности `async`:

*  **Не блокирует парсинг HTML**
*  **Загружается параллельно**
*  **Порядок выполнения не гарантирован**
*  **Может прервать рендеринг**

**Пример с несколькими async-скриптами:**

```html
<script async src="jquery.js"></script>
<script async src="app.js"></script>
<script async src="analytics.js"></script>
```

 `app.js` может выполниться раньше `jquery.js`, даже если загрузился позже!

---

##  Атрибут `defer`

**Отложенное выполнение** — скрипт загружается параллельно, но выполняется только после завершения парсинга HTML.

```html
<script defer src="app.js"></script>
```

**Что происходит:**
1. Браузер находит тег `<script defer>`
2. **Продолжает парсить HTML** (не блокирует)
3. Загружает `app.js` **параллельно**
4. **Ждет завершения парсинга HTML**
5. Выполняет скрипт **в правильном порядке**

---

###  Особенности `defer`:

*  **Не блокирует парсинг HTML**
*  **Загружается параллельно**
*  **Гарантированный порядок выполнения**
*  **Выполняется после парсинга HTML**

**Пример с несколькими defer-скриптами:**

```html
<script defer src="jquery.js"></script>
<script defer src="app.js"></script>
<script defer src="analytics.js"></script>
```

 Всегда выполнится в порядке: `jquery.js` → `app.js` → `analytics.js`

---

##  Сравнение стратегий

| Атрибут | Блокировка | Загрузка | Выполнение | Порядок |
|---------|------------|----------|------------|---------|
| **Нет** |  Блокирует | Последовательно | Сразу |  Гарантирован |
| **`async`** |  Не блокирует | Параллельно | Сразу |  Не гарантирован |
| **`defer`** |  Не блокирует | Параллельно | После HTML |  Гарантирован |

---

##  Когда использовать что?

###  **`async`** — для:
* Аналитики (Google Analytics, Yandex.Metrica)
* Виджетов социальных сетей
* Скриптов, не зависящих от DOM
* Кода, который должен выполниться как можно быстрее

```html
<!-- Аналитика -->
<script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>

<!-- Виджет -->
<script async src="https://platform.twitter.com/widgets.js"></script>
```

###  **`defer`** — для:
* Основной логики приложения
* Скриптов, работающих с DOM
* Библиотек (jQuery, React, Vue)
* Кода, требующего правильного порядка

```html
<!-- Библиотеки -->
<script defer src="jquery.min.js"></script>
<script defer src="bootstrap.js"></script>

<!-- Основной код -->
<script defer src="app.js"></script>
```

###  **Без атрибутов** — для:
* Критически важных скриптов
* Кода, который должен выполниться до рендеринга
* Скриптов, создающих контент

```html
<!-- Критический скрипт -->
<script src="critical.js"></script>
```

---

##  Практический пример

**Страница с несколькими скриптами:**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Мой сайт</title>
  
  <!-- Критический CSS -->
  <link rel="stylesheet" href="critical.css">
  
  <!-- Аналитика (не блокирует) -->
  <script async src="analytics.js"></script>
  
  <!-- Основные библиотеки (отложенное выполнение) -->
  <script defer src="jquery.js"></script>
  <script defer src="bootstrap.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <h1>Заголовок</h1>
  <p>Контент загружается быстро!</p>
  
  <!-- Виджет (не блокирует) -->
  <script async src="widget.js"></script>
</body>
</html>
```

**Результат:**
* Страница отображается **быстро**
* Аналитика загружается **параллельно**
* Основной код выполняется **в правильном порядке**
* Пользователь видит контент **немедленно**

---

##  Итог

**`async` и `defer`** — мощные инструменты для оптимизации загрузки страниц:

* **`async`** — для независимых скриптов, которые должны выполниться быстро
* **`defer`** — для основного кода, требующего правильного порядка
* **Без атрибутов** — только для критически важных скриптов

Правильное использование этих атрибутов может **значительно ускорить** загрузку ваших веб-страниц и улучшить пользовательский опыт.

--- 