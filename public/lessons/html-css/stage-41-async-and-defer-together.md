#  Этап 41 — Async и defer одновременно

**Что происходит, если в одном теге `<script>` указаны оба атрибута `async` и `defer`?**

---

##  Правило приоритета

**При одновременном использовании `async` и `defer` браузер игнорирует `defer` и использует только `async`.**

```html
<script src="script.js" async defer></script>
```

**Результат:** Скрипт загружается асинхронно и выполняется сразу после загрузки (как с `async`).

---

##  Почему так происходит?

###  **Спецификация HTML:**

* `async` — выполняется сразу после загрузки
* `defer` — выполняется после парсинга HTML
* **Приоритет:** `async` имеет приоритет над `defer`

###  **Логика браузера:**

1. Браузер видит оба атрибута
2. Выбирает `async` (более "агрессивный")
3. Игнорирует `defer`
4. Загружает и выполняет скрипт по правилам `async`

---

##  Практические примеры

###  **Пример 1: Неправильное использование**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Неправильное использование</title>
  
  <!--  Плохо: оба атрибута -->
  <script src="jquery.js" async defer></script>
  <script src="app.js" async defer></script>
</head>
<body>
  <h1>Проблемная страница</h1>
  <p>Скрипты могут выполниться в непредсказуемом порядке!</p>
</body>
</html>
```

**Проблема:** `app.js` может выполниться до `jquery.js`, что вызовет ошибку.

###  **Пример 2: Правильное использование**

```html
<!DOCTYPE html>
<html>
<head>
  <title>Правильное использование</title>
  
  <!--  Хорошо: только defer для зависимых скриптов -->
  <script defer src="jquery.js"></script>
  <script defer src="app.js"></script>
  
  <!--  Хорошо: только async для независимых -->
  <script async src="analytics.js"></script>
</head>
<body>
  <h1>Оптимизированная страница</h1>
  <p>Скрипты загружаются правильно!</p>
</body>
</html>
```

**Результат:** Правильный порядок выполнения зависимых скриптов.

---

##  Рекомендации

###  ** Правильно:**

* Используйте **только `defer`** для зависимых скриптов
* Используйте **только `async`** для независимых скриптов
* Никогда не используйте оба атрибута одновременно

###  ** Неправильно:**

* `async defer` — путаница и непредсказуемое поведение
* `async` для зависимых скриптов — ошибки порядка выполнения
* `defer` для аналитики — медленная загрузка

---

##  Итог

**Правило простое:** один атрибут на скрипт!

* **`defer`** — для основного кода с зависимостями
* **`async`** — для независимых скриптов (аналитика, виджеты)
* **Никогда не используйте оба одновременно**

---