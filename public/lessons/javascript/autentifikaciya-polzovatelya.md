#  Что такое "аутентификация пользователя"?

Аутентификация — это процесс, с помощью которого приложение удостоверяется, кто вы. Обычно вы входите в систему с логином и паролем, а затем получаете **токен** (например, JWT — JSON Web Token), который удостоверяет вашу личность в следующих запросах.

Этот токен можно **где-то сохранить**, чтобы:

* проверять авторизацию пользователя;
* отправлять его с запросами к серверу;
* узнавать, вошел ли пользователь в систему.

---

##  Где можно хранить этот токен?

Три основных варианта:

* `sessionStorage`
* `localStorage`
* `cookies`

Каждый из них ведет себя по-разному. Разберем их.

---

##  1. `sessionStorage`: временно, только в текущей вкладке

### Особенности:

* Данные сохраняются **только до закрытия вкладки**.
* Видны **только в той вкладке**, где были созданы.
* Не отправляются с HTTP-запросами автоматически.

### Как использовать:

```js
// Сохраняем токен после входа
sessionStorage.setItem("authToken", "ваш_токен");

// Получаем токен
const token = sessionStorage.getItem("authToken");
```

### Подходит для:

* Одноразовых сессий (например, банковский вход).
* Минимизации риска кражи токена (если пользователь закроет вкладку — токен исчезнет).

### Недостатки:

* Пользователь закрыл вкладку — всё пропало.
* Нельзя использовать при множестве вкладок (нужно логиниться заново).

---

##  2. `localStorage`: долго, но не безопасно

### Особенности:

* Данные сохраняются **навсегда**, пока пользователь сам не очистит или не выйдет.
* **Доступны из любого JavaScript-кода** в пределах того же домена.
* Не отправляются автоматически с HTTP-запросами.

### Как использовать:

```js
localStorage.setItem("authToken", "ваш_токен");
const token = localStorage.getItem("authToken");
```

### Подходит для:

* Долгосрочного хранения токенов (например, «запомнить меня»).
* SPA-приложений, где вы сами отправляете токен с запросами.

### Недостатки:

* **Уязвим к XSS** (вредоносный JS может украсть токен).
* Нужно вручную удалять токен при выходе:

```js
localStorage.removeItem("authToken");
```

---

##  3. Cookies: безопаснее, но сложнее

### Особенности:

* Могут быть настроены как **доступные только серверу** (`HttpOnly`).
* **Автоматически отправляются** с каждым запросом к серверу.
* Можно настроить срок действия, домен, защиту по HTTPS и многое другое.

### Как использовать:

#### На клиенте:

```js
document.cookie = "authToken=ваш_токен";
```

#### На сервере:

```http
Set-Cookie: authToken=ваш_токен; HttpOnly; Secure; SameSite=Strict;
```

### Подходит для:

* Повышенной безопасности (особенно с `HttpOnly`, `Secure`).
* Сценариев, где важно, чтобы токен **всегда автоматически отправлялся с запросом**.

### Недостатки:

* Требует серверной настройки.
* Труднее удалить и отследить (если `HttpOnly`, нельзя управлять через JS).
* Ограничение по размеру: \~4KB на cookie.

---

##  Таблица сравнения

| Хранилище        | Срок хранения        | Доступ из JS | Автоотправка с запросами | Защита `HttpOnly` | Устойчивость к XSS  |
| ---------------- | -------------------- | ------------ | ------------------------ | ----------------- | ------------------- |
| `sessionStorage` | Пока вкладка открыта |  Да         |  Нет                    |  Нет             |  Уязвим            |
| `localStorage`   | Постоянно            |  Да         |  Нет                    |  Нет             |  Уязвим            |
| `cookies`        | Зависит от настройки |  Частично  |  Да                     |  Да (если задан) |  Да (с `HttpOnly`) |

---

##  Когда что использовать?

| Сценарий                                                              | Рекомендация                                   |
| --------------------------------------------------------------------- | ---------------------------------------------- |
| Простой SPA, нет доступа к серверу — просто храним токен              | `localStorage`                                 |
| Высокая безопасность (банк, финансы, корпоратив)                      | `cookies` с `HttpOnly` и `Secure`              |
| Нужно временное хранение (не между сессиями)                          | `sessionStorage`                               |
| Пользователь не должен остаться в системе после перезагрузки страницы | `sessionStorage`                               |
| Нужно «запомнить пользователя» на долгий срок                         | `localStorage` или `cookies` с датой истечения |

---

##  Итог

* Если важна безопасность — используйте cookies с HttpOnly и Secure.

* Если нужна простота и контроль на клиенте — localStorage или sessionStorage.

* Если токен нужен только до закрытия вкладки — sessionStorage.

* Если нужна долгая авторизация — localStorage (с защитой от XSS) или cookies.

##  ЗАДАЧИ

Вот задачи по теме `аутентификации с использованием sessionStorage, localStorage и cookies`:

---

###  Задача 1: Где хранится токен?

 На сайте после логина вы сохраняете токен в `localStorage`. Закройте браузер, откройте снова — авторизация сохраняется?

<details>
<summary> Вывод</summary>

Да, токен в `localStorage` сохраняется между сессиями. Пользователь останется авторизован, пока вы вручную не удалите токен или не очистите кэш.

</details>

---

###  Задача 2: Безопасен ли localStorage?

 Почему нельзя хранить JWT в `localStorage` без дополнительной защиты?

<details>
<summary> Вывод</summary>

Потому что токен может быть доступен через JavaScript. Если произойдет XSS-атака, злоумышленник сможет украсть токен и использовать его.

</details>

---

###  Задача 3: Cookies и безопасность

 Вы сохраняете токен в cookies. Какие флаги нужно добавить, чтобы повысить безопасность?

<details>
<summary> Вывод</summary>

* `HttpOnly` — запрет на доступ из JS
* `Secure` — работает только через HTTPS
* `SameSite=Strict` или `Lax` — ограничивает отправку с внешних сайтов

</details>

---

###  Задача 4: sessionStorage на вкладках

 Войдите в приложение, токен сохранён в `sessionStorage`. Откройте ту же страницу в новой вкладке. Будет ли пользователь авторизован?

<details>
<summary> Вывод</summary>

Нет, `sessionStorage` работает только в рамках текущей вкладки. Новая вкладка начнёт с "чистой" сессии.

</details>

---

###  Задача 5: Выход из системы

 Пользователь нажал "Выйти". Где нужно удалить токен, если он хранится:

* в `localStorage`?
* в cookies?

<details>
<summary> Вывод</summary>

* В `localStorage`: вызвать `localStorage.removeItem('token')`
* В cookies: отправить cookie с истекшим сроком жизни (например, `Set-Cookie: token=; expires=Thu, 01 Jan 1970 00:00:00 GMT;`)

</details>

---

 Задачи показали, как ведут себя `sessionStorage`, `localStorage` и cookies в контексте аутентификации — в чем плюсы и риски каждого метода хранения, когда данные сохраняются, передаются и исчезают.

---