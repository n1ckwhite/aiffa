#  Влияние настройки "Блокировать все cookies" на `localStorage` и `sessionStorage`

###  Что происходит при блокировке cookies?

Когда пользователь в браузере включает настройку **"Блокировать все cookies"**, это влияет **только на cookies** — как устанавливаемые клиентом (JavaScript), так и сервером (заголовком `Set-Cookie`).

---

###  Что при этом с `localStorage` и `sessionStorage`?

* `**localStorage**` и `**sessionStorage**` остаются **работоспособными**.
* Они не зависят от cookies и работают независимо от их состояния.
* Даже при полном отключении cookies, вы можете сохранять и считывать данные в этих хранилищах через JavaScript.

```javascript
localStorage.setItem("example", "yes");
console.log(localStorage.getItem("example")); // "yes"
```

---

###  Но почему это может всё же влиять на приложение?

Хотя сами `localStorage` и `sessionStorage` работают:

* Если ваше приложение использует cookies для **аутентификации** (например, `HttpOnly` cookie с JWT), пользователи не смогут пройти авторизацию или остаться залогиненными.
* Если на сервере логика сессии завязана на cookies, то при их блокировке пользователь будет постоянно "вылетать" из сессии.

---

###  Что стоит делать разработчику?

* **Проверять доступность cookies**, если от них зависит функциональность.
* **Показывать предупреждение**, если cookies заблокированы и это мешает работе.
* **Использовать `localStorage`/`sessionStorage`**, если можно избежать использования cookies (например, при SPA и JWT в заголовках).

---

##  Итог

Блокировка всех `cookies` в браузере **не влияет** на работу `localStorage` и `sessionStorage` — они продолжают функционировать. Однако, если приложение использует `cookies` для **аутентификации или сессий**, это может нарушить его работу. Разработчику важно учитывать это и предлагать альтернативы или уведомления пользователю.

##  ЗАДАЧИ

Вот задачи по теме блокировки cookies и взаимодействия с `localStorage` / `sessionStorage`:

---

###  Задача 1: Почему не работает вход?

 Пользователь жалуется, что не может авторизоваться в вашем SPA-приложении. Вы используете `HttpOnly`-cookie с JWT. При этом у пользователя включена настройка "Блокировать все cookies".

<details>
<summary> Вывод</summary>

При включённой блокировке cookies браузер не сохраняет даже `HttpOnly`-cookies, а значит, токен не отправляется на сервер.
Решения:

* Использовать `localStorage` или `sessionStorage` как fallback (но будьте осторожны с XSS);
* Сообщить пользователю о необходимости включить cookies.

</details>

---

###  Задача 2: Где корзина?

 Ваш клиент жалуется: "Я добавил товары в корзину, а они исчезли после перезагрузки!" При этом cookies заблокированы.

<details>
<summary> Вывод</summary>

Если корзина сохранялась в cookie, данные теряются при блокировке. Используйте `localStorage` — он не зависит от cookies и сохранит данные между сессиями, даже если cookies отключены.

</details>

---

###  Задача 3: Проверка на cookies

 Вы хотите убедиться, что cookies доступны в браузере пользователя, прежде чем полагаться на них.

<details>
<summary> Вывод</summary>

Проверьте доступность cookies через JavaScript:

```js
document.cookie = "testcookie=1";
const cookiesEnabled = document.cookie.indexOf("testcookie") !== -1;
```

Если `cookiesEnabled === false`, предупредите пользователя или переключитесь на `localStorage`.

</details>

---

###  Задача 4: Куда сохранить?

 Нужно сохранить:

* токен доступа (временно);
* цветовую тему;
* содержимое корзины;
* настройки текущей вкладки.

Выберите, что куда класть — `cookies`, `localStorage`, `sessionStorage`.

<details>
<summary> Вывод</summary>

* Токен доступа: `cookies` (если `HttpOnly`) или `sessionStorage` (если не нужно долго хранить).
* Цветовая тема: `localStorage`.
* Корзина: `localStorage`.
* Настройки вкладки: `sessionStorage`.

</details>

---

###  Задача 5: Какой запасной путь?

 Вы используете `HttpOnly`-cookie для хранения токена. Но при заблокированных cookies токен не передаётся. Нужно предусмотреть альтернативу.

<details>
<summary> Вывод</summary>

Храните токен в `sessionStorage` как временный запасной вариант. Тогда вы сможете вручную добавлять `Authorization`-заголовок:

```js
const token = sessionStorage.getItem("token");
fetch("/api/user", {
  headers: { Authorization: `Bearer ${token}` }
});
```

</details>

---

 Разобрали, как cookies, localStorage и sessionStorage взаимодействуют с безопасностью, кросс-доменными запросами, настройками браузера и аутентификацией. Задачи помогли закрепить практические подходы: защита от XSS/CSRF, настройка хранения токенов, диагностика проблем с кэшем и поведение при блокировке cookies.

---