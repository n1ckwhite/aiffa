#  Как анализировать утечки памяти в Chrome DevTools

Утечки памяти в веб-приложениях могут существенно повлиять на производительность и стабильность. Это происходит, когда объекты, которые больше не нужны, продолжают оставаться в памяти из-за непреднамеренных ссылок. К счастью, **Chrome DevTools** предоставляет инструменты для отслеживания и устранения таких проблем.

---

###  1. Открытие Chrome DevTools

Чтобы начать анализ:

* Запустите Chrome и откройте страницу, поведение которой вы хотите исследовать.
* Откройте DevTools:

    * `F12`
    * или `Ctrl + Shift + I` (Windows/Linux)
    * или `Cmd + Option + I` (Mac)

---

###  2. Переход во вкладку Memory

* В верхней панели DevTools выберите вкладку **Memory**.
* Если вкладка не отображается, нажмите на значок `»` и выберите её из списка.

---

###  3. Обзор режимов анализа памяти

Во вкладке **Memory** доступны три основных инструмента:

#### Heap Snapshot (Снимок кучи)

* Делает снимок текущего состояния памяти.
* Показывает дерево объектов, их размеры, количество экземпляров и связи.
* Позволяет находить объекты, которые не освобождаются.

#### Allocation Instrumentation on Timeline (Хронология распределения)

* Записывает выделение памяти в реальном времени.
* Используется для выявления утечек, вызванных определёнными действиями пользователя.
* График показывает, как память "растёт" и не освобождается.

#### Allocation Sampling (Выборка распределения)

* Менее ресурсоёмкий режим.
* Отслеживает частоту создания объектов и их типы.
* Подходит для длительного мониторинга.

---

###  4. Как собрать данные

#### Снимок памяти

1. Перейдите в режим **Heap snapshot**.
2. Нажмите **Take snapshot**.
3. Подождите завершения анализа — появится список объектов.

#### Хронология распределения

1. Переключитесь на **Allocation instrumentation on timeline**.
2. Нажмите **Start**.
3. Выполните действия в приложении, которые могут вызывать утечку (например, переход между страницами, открытие модалок, добавление элементов).
4. Нажмите **Stop**.
5. Изучите график и распределение памяти.

---

###  5. Интерпретация результатов

#### A. Heap snapshot

* Обратите внимание на:

    * Объекты с большим **retained size** — объём памяти, который они удерживают.
    * **Detached DOM trees** — элементы, удалённые из DOM, но всё ещё находящиеся в памяти.
    * Постоянно увеличивающееся число одинаковых объектов.

#### B. Timeline

* Поищите "ступенчатый" рост графика без возврата вниз — это признак утечки.
* Выделите период и изучите список объектов, созданных в этот момент.
* Сравните несколько записей до и после подозрительных действий.

---

###  6. Что искать при утечках

Наиболее распространённые источники утечек:

* **Слушатели событий**, не удаляемые при удалении элементов.
* **Замыкания**, содержащие ненужные ссылки.
* **Глобальные переменные**, которые "держат" объекты.
* **Кеши или массивы**, куда накапливаются ссылки на старые данные.

---

###  7. Устранение утечек

После нахождения проблемы:

* Удалите слушатели через `removeEventListener`.
* Обнуляйте ссылки после использования: `obj = null`.
* Используйте `WeakMap` или `WeakRef`, если нужно безопасно хранить временные данные.
* Перепроверьте сторонние библиотеки: утечки могут происходить и внутри них.

---

###  8. Повторная проверка

* После изменений перезагрузите страницу и повторите анализ.
* Проверьте, сохраняется ли память после выполнения тех же действий.
* При необходимости снимите несколько Heap Snapshot подряд и сравните их.

---

##  Итог

Анализ утечек памяти требует системного подхода и наблюдательности. Chrome DevTools предоставляет все необходимые средства: снимки памяти, графики распределения и удобный интерфейс анализа. Постоянный контроль за использованием памяти позволяет:

* Избежать тормозов и подвисаний;
* Повысить стабильность приложения;
* Сэкономить ресурсы пользователя.

Профилактика утечек особенно важна в долгоживущих приложениях, например, SPA или дашбордах.

---
