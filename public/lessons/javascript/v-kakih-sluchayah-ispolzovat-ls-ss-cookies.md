#  Что выбрать: Cookies, LocalStorage или SessionStorage?

Работая с данными на клиенте, важно понимать, **когда использовать** каждый из доступных механизмов хранения. `Cookies`, `LocalStorage` и `SessionStorage` решают разные задачи и **не являются взаимозаменяемыми**. Ниже — разбор типичных ситуаций и то, какой инструмент предпочтителен в каждом случае.

---

##  Когда стоит выбрать **Cookies**

### 1. Аутентификация и управление сессией

Если вы реализуете вход по токену (например, JWT), и хотите, чтобы данные автоматически **передавались серверу при каждом запросе**, используйте cookies. Особенно если сервер на стороне бэкенда сам проверяет сессию.

> Преимущество: cookie с флагом `HttpOnly` не читается из JavaScript, что защищает от XSS-атак.

### 2. Интеграция с серверной логикой

Если необходимо, чтобы сервер **всегда имел доступ к данным**, например, для персонализации ответа или отслеживания активности — cookie подойдут лучше, чем LocalStorage.

### 3. Безопасность

Cookies позволяют настроить:

* `Secure`: передача только по HTTPS,
* `SameSite`: защита от CSRF,
* `HttpOnly`: запрет на доступ из JS.

Это делает их **надежнее** для хранения чувствительной информации (сессионных ключей, настроек авторизации и т.д.).

---

##  Когда предпочтительнее **LocalStorage**

### 1. Постоянные данные пользователя

Если вы хотите хранить **долговременные предпочтения пользователя**, такие как:

* тема оформления сайта,
* последний открытый раздел,
* настройки интерфейса.

LocalStorage сохраняет данные **до ручного удаления**, даже между перезапусками браузера.

### 2. Большой объем данных

Для хранения данных на стороне клиента, **которые не должны отправляться на сервер автоматически** — например, кэш, черновики, результаты форм, LocalStorage предпочтительнее.

>  Важно: LocalStorage небезопасен. Он доступен из любого JavaScript-кода, исполняемого на странице, поэтому **никогда не храните здесь токены или личную информацию.**

---

##  Когда использовать **SessionStorage**

### 1. Временное состояние

Если вы хотите сохранить информацию только на время открытой вкладки, например:

* текущий шаг в форме,
* параметры фильтра на странице,
* локальный выбор, который не должен пережить перезагрузку.

SessionStorage автоматически очищается при закрытии вкладки, что исключает накопление устаревших данных.

### 2. Изоляция между вкладками

Сценарий: пользователь открыл сайт в нескольких вкладках и взаимодействует с каждой независимо. SessionStorage позволит сохранить **разные данные в каждой вкладке**, чего нельзя достичь с LocalStorage.

---

##  Сравнительная таблица

| Характеристика                       | Cookies                    | LocalStorage | SessionStorage |
| ------------------------------------ | -------------------------- | ------------ | -------------- |
| Автоматически отправляются на сервер |                           |             |               |
| Доступны между сессиями              |  (если указано `Expires`) |             |               |
| Доступ только в одной вкладке        |                           |             |               |
| Поддержка флагов безопасности        |  (`Secure`, `HttpOnly`)   |             |               |
| Максимальный объем                   | \~4 КБ                     | 5–10 МБ      | 5–10 МБ        |
| Доступность через JavaScript         | При `HttpOnly` —          |             |               |
| Удобство работы из JS                |  Меньшее                 |             |               |

---

##  Итог

**Правильный выбор механизма хранения — это баланс между функциональностью, безопасностью и удобством.**

* Выбирайте **Cookies**, когда данные должны автоматически доходить до сервера и быть защищены от JavaScript.
* Используйте **LocalStorage**, если нужно сохранить данные надолго и они не являются конфиденциальными.
* Применяйте **SessionStorage** для временных, изолированных данных в рамках одной сессии браузера.


##  ЗАДАЧИ

Вот несколько задач, которые помогут вам закрепить понимание `Использование хранение и с какой технической точкой зрения`:

---

###  Задача 1: Где жить токену?

 В приложении токен аутентификации хранится в `localStorage`. После выхода пользователя с одного устройства — он всё ещё авторизован на другом. Почему? Как это исправить?

<details>
<summary> Вывод</summary>

`localStorage` — это механизм, полностью клиентский и изолированный по устройствам и браузерам. Если пользователь вышел на одном устройстве, это не влияет на другие. Чтобы решить проблему, можно:

* Хранить токен в **HttpOnly cookie** — они доступны только на сервере, автоматически удаляются при истечении срока и могут быть отозваны;
* Или реализовать серверную логику **отзыва токенов**: например, черный список на бэкенде.

</details>

---

###  Задача 2: Почему пропала корзина?

 Данные корзины хранятся в `sessionStorage`. Пользователь обновляет страницу — и корзина пустая. Почему так? Как сохранить данные при обновлении страницы, но очистить при закрытии браузера?

<details>
<summary> Вывод</summary>

`sessionStorage` привязан к текущей вкладке. **Даже при обновлении вкладки** создаётся новая сессия, и данные теряются. Чтобы сохранить состояние корзины при обновлении, но удалить при закрытии браузера, можно:

* Хранить данные в `localStorage` и вручную очищать их при событии `beforeunload`, если `performance.navigation.type === 1` (не закрытие, а обновление);
* Либо использовать **in-memory store**, если перезагрузка не критична.

</details>

---

###  Задача 3: Куда делся апдейт?

 Ваша JS-фича перестала обновляться у пользователей. Подозрение — браузер кэширует старую версию `app.js`. Как убедиться, что это так, и исправить?

<details>
<summary> Вывод</summary>

Открой DevTools → вкладка **Network**, найди `app.js`, посмотри **Response Headers**. Если там `Cache-Control: max-age=31536000`, то файл кэшируется надолго. Чтобы избежать таких ситуаций:

* Добавляйте **хеш в имя файла** (`app.8f6e2.js`);
* Или меняйте версию в URL (`app.js?v=2`), чтобы обойти кэш.

</details>

---

###  Задача 4: Почему куки не читаются?

 Вы установили cookie с флагом `HttpOnly`, а затем пытаетесь прочитать её через `document.cookie`. Возвращается пусто. Почему?

<details>
<summary> Вывод</summary>

Флаг `HttpOnly` означает, что cookie недоступна JavaScript-коду в браузере. Это сделано в целях безопасности, чтобы защитить чувствительные данные (например, токены) от XSS-атак. Такие cookie можно читать и использовать **только на сервере**.

</details>

---

###  Задача 5: Почему не работает logout?

 После выхода из аккаунта ты удаляешь токен из `localStorage`, но пользователь всё ещё получает доступ к защищённым данным при обновлении страницы. Как это возможно?

<details>
<summary> Вывод</summary>

Даже если токен удалён из `localStorage`, **если он был ранее сохранён в cookies с флагом `HttpOnly`**, браузер будет продолжать отправлять его с каждым запросом, и сервер будет считать пользователя авторизованным.

Проверь:

* Есть ли токен в cookies? (`Application → Storage → Cookies`);
* Убедись, что logout очищает **все источники**, включая cookies (через сервер или заголовок `Set-Cookie: token=; Max-Age=0`).

</details>

---

###  Задача 6: Почему кэш не сработал?

 Ты настроил Service Worker с кэшированием файлов, но после отключения интернета сайт перестал загружаться. Почему?

<details>
<summary> Вывод</summary>

Service Worker работает **только после первого успешного визита**, когда он был установлен. Если пользователь впервые зашёл без интернета — он не успел закешировать ничего.

Проверь:

* Вкладку **Application → Service Workers**, чтобы убедиться, что воркер установлен и активен;
* Стратегию кэширования — возможно, ты используешь `networkFirst`, и она не срабатывает оффлайн;
* Обработку события `fetch` — убедись, что возвращается ответ из кэша, если сеть недоступна.

</details>

---

 Разобрали поведение `localStorage`, `sessionStorage` и `cookies`, проверили кэширование через заголовки и изучили, как данные ведут себя в разных вкладках.
Получили практическое понимание механизмов хранения и кэширования в браузере.

---