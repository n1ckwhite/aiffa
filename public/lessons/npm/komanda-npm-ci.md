#  Команда npm ci

Команда `npm ci` (Continuous Integration) — это специализированный инструмент для быстрой и надежной установки зависимостей в автоматизированных средах. Она обеспечивает воспроизводимые результаты установки.

---

##  Что такое npm ci?

**npm ci** — это команда для чистой установки зависимостей, оптимизированная для CI/CD пайплайнов и автоматизированных сред.

###  Основные характеристики:
-  **Скорость** - быстрее npm install
-  **Надежность** - строго следует package-lock.json
-  **Автоматизация** - идеальна для CI/CD
-  **Предсказуемость** - гарантирует одинаковые результаты

---

##  Как работает npm ci?

###  Основной процесс

**Последовательность действий:**
```bash
# 1. Удаление node_modules (если существует)
# 2. Установка зависимостей из package-lock.json
# 3. Проверка соответствия package.json
npm ci
```

**Ключевые особенности:**
- Автоматически удаляет папку `node_modules`
- Устанавливает зависимости точно по `package-lock.json`
- Не изменяет `package.json` или `package-lock.json`
- Завершается с ошибкой при несоответствии версий

###  Требования для работы

**Обязательные файлы:**
```bash
# Должны присутствовать:
package.json          # Описание проекта и зависимостей
package-lock.json     # Точные версии всех зависимостей
```

**Структура проекта:**
```
project/
├── package.json
├── package-lock.json
└── (node_modules будет создана)
```

---

##  Основные функции команды npm ci

###  Чистая установка

**Автоматическая очистка:**
```bash
# Удаляет node_modules и устанавливает заново
npm ci

# Эквивалент ручной очистки:
rm -rf node_modules
npm install
```

**Преимущества:**
- Устраняет конфликты от предыдущих установок
- Обеспечивает чистую среду
- Предотвращает проблемы с кэшем

###  Установка из package-lock.json

**Строгое следование lock-файлу:**
```bash
# Устанавливает точные версии из package-lock.json
npm ci

# Проверяет соответствие package.json
# Завершается с ошибкой при несоответствии
```

**Поведение:**
- Не разрешает зависимости заново
- Использует готовое дерево зависимостей
- Гарантирует воспроизводимость

###  Обработка ошибок

**Сценарии ошибок:**
```bash
# Ошибка: отсутствует package-lock.json
npm ci
# → Error: npm ci can only install packages when a package-lock.json is present.

# Ошибка: несоответствие версий
npm ci
# → Error: The package-lock.json file is out of sync with package.json
```

**Решение ошибок:**
```bash
# Создание package-lock.json
npm install

# Синхронизация файлов
npm install
```

---

##  Флаги и опции

###  Основные флаги

**Флаги для установки:**
```bash
# Установка только production зависимостей
npm ci --only=production

# Установка с игнорированием devDependencies
npm ci --omit=dev

# Установка с игнорированием скриптов
npm ci --ignore-scripts
```

**Флаги для отладки:**
```bash
# Подробный вывод
npm ci --verbose

# Тихий режим
npm ci --silent

# Проверка без установки
npm ci --dry-run
```

###  Флаги для оптимизации

**Оптимизация производительности:**
```bash
# Установка без аудита
npm ci --no-audit

# Установка без фонда
npm ci --no-fund

# Установка без обновления
npm ci --no-update-notifier
```

---

##  Практические примеры

###  Сценарий 1: CI/CD пайплайн

**GitHub Actions пример:**
```yaml
name: Build and Test
on: [push, pull_request]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm test
      - run: npm run build
```

**Docker пример:**
```dockerfile
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
CMD ["npm", "start"]
```

###  Сценарий 2: Командная разработка

**Обеспечение согласованности:**
```bash
# Клонирование репозитория
git clone <repository>
cd <project>

# Установка зависимостей
npm ci

# Проверка установки
npm list --depth=0
```

###  Сценарий 3: Продакшн деплой

**Безопасное развертывание:**
```bash
# Подготовка к деплою
npm ci --only=production

# Проверка безопасности
npm audit --audit-level=moderate

# Запуск приложения
npm start
```

---

##  Сравнение с npm install

###  Ключевые различия

| Аспект | npm ci | npm install |
|--------|--------|-------------|
| **Скорость** | Быстрее | Медленнее |
| **Надежность** | Высокая | Средняя |
| **Гибкость** | Низкая | Высокая |
| **Изменение файлов** | Не изменяет | Может изменять |
| **Требования** | package-lock.json | package.json |
| **Использование** | Автоматизация | Разработка |

###  Когда использовать каждую команду

**npm ci подходит для:**
-  CI/CD пайплайнов
-  Продакшн деплоев
-  Тестирования
-  Контейнеризации

**npm install подходит для:**
-  Разработки
-  Обновления зависимостей
-  Экспериментов
-  Командной работы

---

##  Лучшие практики

###  Рекомендации по использованию

**Для автоматизации:**
- Всегда используйте `npm ci` в CI/CD
- Коммитьте `package-lock.json`
- Проверяйте соответствие файлов

**Для разработки:**
- Используйте `npm install` для добавления пакетов
- Регулярно обновляйте `package-lock.json`
- Тестируйте с `npm ci` перед коммитом

###  Безопасность

**Проверка безопасности:**
```bash
# Проверка после установки
npm ci
npm audit

# Установка с проверкой
npm ci --audit
```

---

##  Важные замечания

- **Обязательность package-lock.json** - npm ci требует его наличия
- **Неизменность файлов** - не изменяет package.json или package-lock.json
- **Скорость** - работает быстрее npm install
- **Надежность** - гарантирует воспроизводимые результаты
- **Автоматизация** - идеальна для CI/CD сред

---

##  Итог

Команда `npm ci` — это специализированный инструмент для быстрой и надежной установки зависимостей в автоматизированных средах. Она обеспечивает воспроизводимость и предсказуемость, что критически важно для CI/CD пайплайнов.

##  ЗАДАЧИ

Задачи по теме `Команда npm ci`:

###  Задача 1: Базовая установка

Напишите команду для установки зависимостей с помощью npm ci.

<details>
<summary> Решение</summary>

**Правильная команда:**
```bash
npm ci
```

**Описание решения:**
- `npm ci` - команда для чистой установки зависимостей
- Удаляет node_modules и устанавливает заново
- Использует package-lock.json для точных версий
- Не изменяет package.json или package-lock.json

</details>

---

###  Задача 2: Production установка

Напишите команду для установки только production зависимостей с помощью npm ci.

<details>
<summary> Решение</summary>

**Правильная команда:**
```bash
npm ci --only=production
```

**Описание решения:**
- `npm ci` - команда для чистой установки
- `--only=production` - флаг для установки только production зависимостей
- Исключает devDependencies из установки
- Используется для продакшн деплоев

</details>

---

###  Задача 3: Тихая установка

Напишите команду для тихой установки зависимостей с помощью npm ci.

<details>
<summary> Решение</summary>

**Правильная команда:**
```bash
npm ci --silent
```

**Описание решения:**
- `npm ci` - команда для чистой установки зависимостей
- `--silent` - флаг для подавления вывода в консоль
- Уменьшает количество логов
- Используется в автоматизированных средах

</details>

---

 Освоив команду npm ci, вы сможете эффективно управлять зависимостями в автоматизированных средах!

---