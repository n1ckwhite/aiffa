#  HTTP 401, 403, 404: различия, причины и практика

Коды состояния HTTP **401**, **403** и **404** относятся к различным ситуациям, связанным с доступом к ресурсам на сервере. Каждый код предоставляет важную информацию о состоянии запроса и помогает клиенту понять, как поступить дальше.

##  Основные различия между кодами

### 401 Unauthorized — Неавторизован
- **Описание**: Запрос требует аутентификации, но клиент не предоставил необходимые данные.
- **Причина**: Пользователь не вошёл в систему или не предоставил токен авторизации.
- **Решение**: Пользователь должен войти в систему или предоставить правильные данные для авторизации.

### 403 Forbidden — Доступ запрещён
- **Описание**: Сервер понял запрос, но отказывается его выполнять из-за недостаточных прав.
- **Причина**: Пользователь авторизован, но у него нет прав для доступа к ресурсу.
- **Решение**: Пользователь должен получить соответствующие права или обратиться к администратору.

### 404 Not Found — Не найдено
- **Описание**: Запрашиваемый ресурс не существует на сервере.
- **Причина**: URL неверный, ресурс удалён или никогда не существовал.
- **Решение**: Проверить правильность URL или найти альтернативный ресурс.

---

##  Подробный анализ каждого кода

### 401 Unauthorized — Неавторизован

#### Что означает
Этот код указывает на то, что запрос не был применен, потому что пользователь не предоставил необходимые учетные данные для аутентификации. То есть, доступ к запрашиваемому ресурсу требует аутентификации.

#### Когда используется
- Защищённые API-эндпоинты
- Административные панели
- Личные кабинеты пользователей
- Любые ресурсы, требующие входа в систему

#### Примеры сценариев
```javascript
// Попытка доступа к защищённому API без токена
fetch('/api/protected-data')
  .then(response => {
    if (response.status === 401) {
      console.error('Требуется авторизация');
      // Перенаправить на страницу входа
      window.location.href = '/login';
    }
  });
```

### 403 Forbidden — Доступ запрещён

#### Что означает
Этот код указывает на то, что сервер понял запрос, но отказывается его выполнять. Причиной может быть отсутствие прав доступа у клиента к этому ресурсу, даже если аутентификация была успешной.

#### Когда используется
- Попытка доступа к админ-панели обычным пользователем
- Доступ к файлам, к которым нет прав
- Попытка удалить чужой контент
- Доступ к ресурсам, ограниченным по IP

#### Примеры сценариев
```javascript
// Попытка удалить чужой пост
fetch('/api/posts/123', {
  method: 'DELETE',
  headers: { 'Authorization': 'Bearer user-token' }
})
  .then(response => {
    if (response.status === 403) {
      console.error('Недостаточно прав для удаления');
      showErrorMessage('У вас нет прав для выполнения этого действия');
    }
  });
```

### 404 Not Found — Не найдено

#### Что означает
Этот код указывает на то, что сервер не нашел ни одного ресурса, соответствующего запрашиваемому URI. Это означает, что запрашиваемый ресурс не существует на сервере.

#### Когда используется
- Неверный URL
- Удалённый ресурс
- Опечатка в адресе
- Несуществующий API-эндпоинт

#### Примеры сценариев
```javascript
// Запрос к несуществующему пользователю
fetch('/api/users/999999')
  .then(response => {
    if (response.status === 404) {
      console.error('Пользователь не найден');
      showErrorMessage('Пользователь не существует');
    }
  });
```

---

##  Сравнительная таблица кодов

| Код | Название | Авторизация | Права | Существование ресурса | Типичное решение |
|-----|----------|-------------|-------|----------------------|------------------|
| 401 | Unauthorized |  | - |  | Войти в систему |
| 403 | Forbidden |  |  |  | Получить права |
| 404 | Not Found | - | - |  | Проверить URL |

---

##  Примеры обработки в JavaScript

###  Пример 1: Универсальная обработка ошибок
```javascript
async function fetchWithErrorHandling(url, options = {}) {
  try {
    const response = await fetch(url, options);
    
    if (response.status === 401) {
      console.error('Требуется авторизация');
      redirectToLogin();
      return null;
    }
    
    if (response.status === 403) {
      console.error('Доступ запрещён');
      showForbiddenMessage();
      return null;
    }
    
    if (response.status === 404) {
      console.error('Ресурс не найден');
      showNotFoundMessage();
      return null;
    }
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}: ${response.statusText}`);
    }
    
    return await response.json();
  } catch (error) {
    console.error('Ошибка запроса:', error);
    return null;
  }
}
```

###  Пример 2: Обработка с retry-логикой
```javascript
async function fetchWithRetry(url, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      const response = await fetch(url);
      
      if (response.status === 401) {
        // Для 401 не имеет смысла повторять запрос
        console.error('Требуется авторизация');
        return null;
      }
      
      if (response.status === 403) {
        // Для 403 не имеет смысла повторять запрос
        console.error('Доступ запрещён');
        return null;
      }
      
      if (response.status === 404) {
        // Для 404 не имеет смысла повторять запрос
        console.error('Ресурс не найден');
        return null;
      }
      
      if (!response.ok) {
        throw new Error(`HTTP ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      if (i === maxRetries - 1) {
        throw error;
      }
      // Ждём перед повторной попыткой
      await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
    }
  }
}
```

###  Пример 3: Специализированные обработчики
```javascript
// Обработчик 401 ошибок
function handleUnauthorized() {
  console.log('Пользователь не авторизован');
  
  // Сохраняем текущий URL для возврата после входа
  sessionStorage.setItem('returnUrl', window.location.href);
  
  // Перенаправляем на страницу входа
  window.location.href = '/login';
}

// Обработчик 403 ошибок
function handleForbidden() {
  console.log('Доступ запрещён');
  
  // Показываем понятное сообщение пользователю
  showMessage('У вас нет прав для доступа к этому ресурсу', 'error');
  
  // Предлагаем альтернативные действия
  showAlternativeActions();
}

// Обработчик 404 ошибок
function handleNotFound() {
  console.log('Ресурс не найден');
  
  // Показываем страницу 404
  show404Page();
  
  // Предлагаем поиск или навигацию
  showSearchSuggestions();
}
```

---

##  Практические сценарии использования

### Защищённый API
```javascript
// API с проверкой авторизации
app.get('/api/protected', (req, res) => {
  const token = req.headers.authorization;
  
  if (!token) {
    return res.status(401)
       .set('WWW-Authenticate', 'Bearer')
       .json({ error: 'Требуется авторизация' });
  }
  
  if (!isValidToken(token)) {
    return res.status(401)
       .json({ error: 'Неверный токен' });
  }
  
  // Проверяем права доступа
  if (!hasPermission(token, 'read:protected')) {
    return res.status(403)
       .json({ error: 'Недостаточно прав' });
  }
  
  res.json({ data: 'Защищённые данные' });
});
```

### Файловая система
```javascript
// Обработка файлов с проверкой прав
app.get('/files/:filename', (req, res) => {
  const filename = req.params.filename;
  const user = req.user;
  
  // Проверяем существование файла
  if (!fileExists(filename)) {
    return res.status(404)
       .json({ error: 'Файл не найден' });
  }
  
  // Проверяем авторизацию
  if (!user) {
    return res.status(401)
       .json({ error: 'Требуется авторизация' });
  }
  
  // Проверяем права доступа
  if (!canAccessFile(user, filename)) {
    return res.status(403)
       .json({ error: 'Доступ запрещён' });
  }
  
  res.sendFile(filename);
});
```

---

##  Лучшие практики обработки ошибок

### На стороне клиента
- Показывайте понятные сообщения пользователю.
- Предлагайте альтернативные действия.
- Логируйте ошибки для анализа.
- Не повторяйте запросы при 401, 403, 404.

### На стороне сервера
- Возвращайте правильные статус-коды.
- Предоставляйте полезную информацию в ответе.
- Логируйте ошибки для анализа безопасности.
- Настройте кастомные страницы ошибок.

###  Пример кастомной страницы 404
```html
<!DOCTYPE html>
<html>
<head>
    <title>Страница не найдена</title>
</head>
<body>
    <h1>404 - Страница не найдена</h1>
    <p>К сожалению, запрашиваемая страница не существует.</p>
    <a href="/">Вернуться на главную</a>
    <a href="/search">Поиск</a>
</body>
</html>
```

---

##  Итог

- **401 Unauthorized** — требуется авторизация (пользователь не вошёл).
- **403 Forbidden** — доступ запрещён (нет прав, но авторизован).
- **404 Not Found** — ресурс не существует.
- Правильная обработка этих ошибок улучшает пользовательский опыт.
- Каждый код требует своего подхода к решению проблемы.

##  ЗАДАЧИ

Задачи по теме `HTTP 401, 403, 404 различия`:

---

###  Задача 1: Определи ошибку
Какой код вернёт сервер, если пользователь попытается получить доступ к защищённой странице без авторизации?
<details>
<summary> Решение</summary>

**Ответ:**
401 Unauthorized — требуется авторизация для доступа к ресурсу.

</details>

---

###  Задача 2: Разница между 401 и 403
В чём разница между ошибками 401 Unauthorized и 403 Forbidden?
<details>
<summary> Решение</summary>

**Ответ:**
401 — пользователь не авторизован (нужно войти в систему).
403 — пользователь авторизован, но у него нет прав для доступа к ресурсу.

</details>

---

###  Задача 3: Обработка 404
Какой код вернёт сервер при запросе к несуществующему API-эндпоинту?
<details>
<summary> Решение</summary>

**Ответ:**
404 Not Found — запрашиваемый ресурс не найден на сервере.

</details>

---

###  Задача 4: Обработка ошибок
Напишите код для обработки ошибок 401, 403 и 404 в fetch-запросе:
<details>
<summary> Решение</summary>

```javascript
fetch('/api/protected')
  .then(response => {
    if (response.status === 401) {
      console.error('Требуется авторизация');
      window.location.href = '/login';
    } else if (response.status === 403) {
      console.error('Доступ запрещён');
      showErrorMessage('Недостаточно прав');
    } else if (response.status === 404) {
      console.error('Ресурс не найден');
      show404Page();
    } else if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    return response.json();
  });
```

</details>

---

###  Задача 5: Retry логика
Почему не имеет смысла повторять запросы при получении 401, 403 и 404?
<details>
<summary> Решение</summary>

**Ответ:**
401 — пользователь не авторизован, повторные запросы не изменят этот факт.
403 — у пользователя нет прав, повторные запросы не дадут прав.
404 — ресурс не существует, повторные запросы не создадут ресурс.

</details>

---

###  Задача 6: Сравнительная таблица
Заполните таблицу различий между кодами 401, 403 и 404:
<details>
<summary> Решение</summary>

| Код | Авторизация | Права | Существование ресурса | Решение |
|-----|-------------|-------|----------------------|---------|
| 401 |  | - |  | Войти в систему |
| 403 |  |  |  | Получить права |
| 404 | - | - |  | Проверить URL |

</details>

---

 Эти задачи помогут понять различия между ошибками доступа и их правильную обработку в веб-приложениях! 
