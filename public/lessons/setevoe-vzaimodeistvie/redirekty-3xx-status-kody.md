#  HTTP редиректы (3xx): теория, типы и практика

Коды состояния HTTP в диапазоне **300 (3xx)** относятся к редиректам и указывают на то, что запрашиваемый ресурс был перемещён или существует несколько вариантов. Эти коды помогают управлять маршрутизацией запросов и обеспечивают более гибкое взаимодействие между клиентом и сервером.

##  Основные типы редиректов (3xx)

### 300 Multiple Choices — Множественный выбор
- **Описание**: Ресурс имеет несколько представлений, клиент должен выбрать одно.
- **Применение**: Разные форматы контента (HTML, JSON, XML).
- **Пример**: API может вернуть данные в JSON или XML формате.

### 301 Moved Permanently — Постоянное перемещение
- **Описание**: Ресурс перемещён на новый URL навсегда.
- **SEO-влияние**: Поисковые системы обновляют индексы.
- **Кэширование**: Браузеры кэшируют новый URL.
- **Пример**: Переезд сайта с HTTP на HTTPS.

### 302 Found — Временное перемещение
- **Описание**: Ресурс временно доступен по другому URL.
- **Сохранение метода**: Не гарантируется (может измениться POST на GET).
- **Пример**: Временное перенаправление при технических работах.

### 303 See Other — Смотрите другой ресурс
- **Описание**: Ресурс доступен по другому URL с методом GET.
- **Применение**: После POST-запросов для перенаправления на страницу подтверждения.
- **Пример**: Перенаправление на "спасибо" после отправки формы.

### 304 Not Modified — Не изменено
- **Описание**: Ресурс не изменялся с момента последнего запроса.
- **Кэширование**: Клиент может использовать кэшированную версию.
- **Заголовки**: Использует ETag и Last-Modified.
- **Пример**: Статические файлы (CSS, JS, изображения).

### 307 Temporary Redirect — Временное перенаправление
- **Описание**: Временное перемещение с сохранением HTTP-метода.
- **Сохранение метода**: POST остаётся POST, PUT остаётся PUT.
- **Пример**: Временное перенаправление API-эндпоинтов.

### 308 Permanent Redirect — Постоянное перенаправление
- **Описание**: Постоянное перемещение с сохранением HTTP-метода.
- **SEO-влияние**: Как 301, но сохраняет метод запроса.
- **Пример**: Перемещение API с сохранением всех методов.

---

##  Примеры редиректов в JavaScript

###  Пример 1: Обработка 301 редиректа
```javascript
fetch('/old-page')
  .then(response => {
    if (response.status === 301) {
      console.log('Страница перемещена на:', response.headers.get('Location'));
      // Автоматическое следование редиректу
      return fetch(response.headers.get('Location'));
    }
    return response;
  })
  .then(response => response.text())
  .then(content => {
    console.log('Новый контент:', content);
  });
```

###  Пример 2: Обработка 304 (кэширование)
```javascript
// Первый запрос
fetch('/api/data', {
  headers: {
    'If-None-Match': 'etag-value',
    'If-Modified-Since': 'Wed, 21 Oct 2023 07:28:00 GMT'
  }
})
  .then(response => {
    if (response.status === 304) {
      console.log('Данные не изменились, используем кэш');
      return null; // Используем кэшированные данные
    }
    return response.json();
  })
  .then(data => {
    if (data) {
      console.log('Новые данные:', data);
    }
  });
```

###  Пример 3: POST с 303 редиректом
```javascript
// Отправка формы
fetch('/submit-form', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'John', email: 'john@example.com' })
})
  .then(response => {
    if (response.status === 303) {
      // Перенаправление на страницу подтверждения
      window.location.href = response.headers.get('Location');
    }
  });
```

###  Пример 4: 307 с сохранением метода
```javascript
// POST запрос с 307 редиректом
fetch('/api/users', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'Jane' })
})
  .then(response => {
    if (response.status === 307) {
      // Метод POST сохраняется при редиректе
      return fetch(response.headers.get('Location'), {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name: 'Jane' })
      });
    }
    return response;
  });
```

---

##  Сравнительная таблица редиректов

| Код | Название | Постоянный | Сохраняет метод | SEO-влияние | Применение |
|-----|----------|------------|-----------------|-------------|------------|
| 300 | Multiple Choices | - | - | - | Выбор формата |
| 301 | Moved Permanently |  |  |  | Постоянное перемещение |
| 302 | Found |  |  |  | Временное перемещение |
| 303 | See Other |  |  |  | После POST на GET |
| 304 | Not Modified | - | - | - | Кэширование |
| 307 | Temporary Redirect |  |  |  | Временное с сохранением метода |
| 308 | Permanent Redirect |  |  |  | Постоянное с сохранением метода |

---

##  Практические сценарии использования

### SEO и 301 редиректы
```javascript
// Серверная настройка 301 редиректа
app.get('/old-page', (req, res) => {
  res.status(301)
     .set('Location', '/new-page')
     .send('Moved Permanently');
});
```

### Кэширование с 304
```javascript
// Проверка кэша на сервере
app.get('/api/data', (req, res) => {
  const etag = generateETag(data);
  const ifNoneMatch = req.headers['if-none-match'];
  
  if (ifNoneMatch === etag) {
    res.status(304).send();
  } else {
    res.set('ETag', etag).json(data);
  }
});
```

### POST с редиректом
```javascript
// Обработка формы с 303 редиректом
app.post('/submit', (req, res) => {
  // Сохраняем данные
  saveData(req.body);
  
  // Перенаправляем на страницу подтверждения
  res.status(303)
     .set('Location', '/thank-you')
     .send();
});
```

---

##  Лучшие практики работы с редиректами

### На стороне клиента
- Следуйте редиректам автоматически (fetch делает это по умолчанию).
- Обрабатывайте 304 для оптимизации кэширования.
- Логируйте редиректы для анализа.

### На стороне сервера
- Используйте правильные коды для SEO (301 для постоянных).
- Предоставляйте заголовок Location.
- Настройте кэширование с ETag и Last-Modified.

###  Пример универсальной обработки
```javascript
async function fetchWithRedirects(url, options = {}) {
  const response = await fetch(url, {
    ...options,
    redirect: 'follow' // Автоматически следовать редиректам
  });
  
  if (response.status === 304) {
    console.log('Используем кэшированные данные');
    return null;
  }
  
  if (response.redirected) {
    console.log('Произошёл редирект на:', response.url);
  }
  
  return response;
}
```

---

##  Итог

- **3xx коды** — редиректы для управления маршрутизацией.
- **301/308** — постоянные перемещения (влияют на SEO).
- **302/307** — временные перемещения.
- **304** — оптимизация кэширования.
- **303** — перенаправление после POST на GET.

##  ЗАДАЧИ

Задачи по теме `HTTP редиректы (3xx)`:

---

###  Задача 1: Постоянный редирект
Какой код используется для постоянного перемещения ресурса с сохранением HTTP-метода?
<details>
<summary> Решение</summary>

**Ответ:**
308 Permanent Redirect — постоянное перемещение с сохранением метода запроса.

</details>

---

###  Задача 2: Кэширование
Какой код позволяет клиенту использовать кэшированную версию ресурса?
<details>
<summary> Решение</summary>

**Ответ:**
304 Not Modified — ресурс не изменился с момента последнего запроса.

</details>

---

###  Задача 3: POST редирект
Какой код используется для перенаправления после POST-запроса на GET-страницу?
<details>
<summary> Решение</summary>

**Ответ:**
303 See Other — перенаправляет на другой URL с использованием метода GET.

</details>

---

###  Задача 4: Временный редирект
В чём разница между 302 и 307 редиректами?
<details>
<summary> Решение</summary>

**Ответ:**
302 — временное перемещение, метод может измениться (POST → GET).
307 — временное перемещение с сохранением HTTP-метода.

</details>

---

###  Задача 5: Обработка редиректов
Напишите код для обработки 301 редиректа в JavaScript:
<details>
<summary> Решение</summary>

```javascript
fetch('/old-url')
  .then(response => {
    if (response.status === 301) {
      const newUrl = response.headers.get('Location');
      console.log('Ресурс перемещён на:', newUrl);
      return fetch(newUrl);
    }
    return response;
  })
  .then(response => response.json())
  .then(data => console.log('Данные:', data));
```

</details>

---

###  Задача 6: SEO влияние
Какие редиректы влияют на SEO и почему?
<details>
<summary> Решение</summary>

**Ответ:**
301 и 308 — постоянные редиректы, которые сообщают поисковым системам о перемещении ресурса на новый URL, что позволяет передать "вес" страницы.

</details>

---

 Эти задачи помогут понять различные типы редиректов и их правильное использование в веб-приложениях! 